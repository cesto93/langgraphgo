# This file contains convenience targets for the project.
# It is not intended to be used as a build system.
# See the README for more information.

.PHONY: test
test:
	go test ./...

.PHONY: lint
lint: lint-deps
	golangci-lint run --color=always --sort-results ./...

.PHONY: lint-fix
lint-fix:
	golangci-lint run --fix --skip-dirs=./exp ./...

.PHONY: test-race
test-race:
	go run test -race ./...

.PHONY: test-cover
test-cover:
	go run test -cover ./...

.PHONY: lint-deps
lint-deps:
	@command -v golangci-lint >/dev/null 2>&1 || { \
		echo >&2 "golangci-lint not found. Installing..."; \
		go install github.com/golangci/golangci-lint/cmd/golangci-lint@v1.57.1; \
	}

coverage:
	go test -coverprofile="cover.out" ./...
	go tool cover -html=cover.out -o cover.html
	go tool cover -func cover.out | grep total | awk "{print $3}"
format:
	gofumpt -w .
